<?xml version="1.0" encoding="utf-8" ?>

<pipeline id="test-pipeline">
    <stages>
		<!--stage type="WPGetPosts">
			<settings>
				<param name="fields">id,title,excerpt,content,status,author,post_date,ai_text_prompt,ai_image_prompt</param>
				<param name="resultTo">posts</param>
			</settings>
		</stage-->
		<stage type="SetValue">
			<settings>
				<param name="parameterName">arrayJson</param>
				<param name="parameterValue">
{
  "data": [
    {
      "id": 1,
      "name": "Elemento 1",
      "attributes": {
        "type": "categoria",
        "details": {
          "value": 123,
          "description": "Descrizione per elemento 1",
          "nested": [
            {
              "id": "A1",
              "status": "attivo",
              "info": {
                "score": 75,
                "meta": "informazioni aggiuntive"
              }
            },
            {
              "id": "A2",
              "status": "inattivo",
              "info": {
                "score": 45,
                "meta": "altre informazioni"
              }
            }
          ]
        }
      }
    },
    {
      "id": 2,
      "name": "Elemento 2",
      "attributes": {
        "type": "gruppo",
        "details": {
          "value": 456,
          "description": "Descrizione per elemento 2",
          "nested": [
            {
              "id": "B1",
              "status": "attivo",
              "info": {
                "score": 88,
                "meta": "altro dettaglio"
              }
            }
          ]
        }
      }
    },
    {
      "id": 3,
      "name": "Elemento 3",
      "attributes": {
        "type": "categoria",
        "details": {
          "value": 789,
          "description": "Descrizione per elemento 3",
          "nested": [
            {
              "id": "C1",
              "status": "attivo",
              "info": {
                "score": 65,
                "meta": "info ulteriori"
              }
            },
            {
              "id": "C2",
              "status": "attivo",
              "info": {
                "score": 95,
                "meta": "altri dati"
              }
            },
            {
              "id": "C3",
              "status": "inattivo",
              "info": {
                "score": 30,
                "meta": "altro testo"
              }
            }
          ]
        }
      }
    }
  ]
}
				</param>
			</settings>
		</stage>
		<stage type="JSONDecode">
			<settings>
				<param name="jsonString" contextReference="plain">arrayJson</param>
				<param name="resultTo">testArray</param>
			</settings>
		</stage>

		<stage type="ArrayPath">
			<settings>
				<param name="array" contextReference="plain">testArray</param>
				<param name="path">data.2.attributes.details.nested</param>
				<param name="resultTo">nestedArray</param>
			</settings>
		</stage>
		<stage type="RandomArrayItem">
			<settings>
				<param name="arrayParameterName">nestedArray</param>
				<param name="resultTo">choosenNestedItem</param>
			</settings>
		</stage>
		<stage type="SetValue">
			<settings>
				<param name="parameterName">referencedKeyPath</param>
				<param name="parameterValue" contextReference="keypath" keypath="data.2.attributes">testArray</param>
			</settings>
		</stage>
		
    </stages>
</pipeline>